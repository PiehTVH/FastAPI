<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', path='css/menu.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.1.0/uicons-bold-rounded/css/uicons-bold-rounded.css'>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300&display=swap" rel="stylesheet">
    <link rel='stylesheet'
        href='https://cdn-uicons.flaticon.com/2.1.0/uicons-regular-straight/css/uicons-regular-straight.css'>
    <link rel='stylesheet'
        href='https://cdn-uicons.flaticon.com/2.1.0/uicons-regular-rounded/css/uicons-regular-rounded.css'>
    <link rel='stylesheet' 
        href='https://cdn-uicons.flaticon.com/2.1.0/uicons-bold-rounded/css/uicons-bold-rounded.css'>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/htmx.org/dist/ext/class-tools.js"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"
        integrity="sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC"
        crossorigin="anonymous"></script>
        <script>
            document.addEventListener('htmx:afterRequest', function (evt) {
                if (evt.detail.xhr.status == 401) {
                    /* Notify the user of a 404 Not Found response */
                    window.location.href = "/pages";
                }
            })
            
        </script>
        <script>
            async function add_booking(room_id, hotel_id, block_id) {
    const url = "/bookings";
    const date_from = document.getElementById("date_from").value;
    const date_to = document.getElementById("date_to").value;
    let myDiv = document.getElementById('nav_box');
    let myDiv_1 = document.getElementById(block_id);
    await fetch(url, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'}, 
        body: JSON.stringify({room_id: room_id, 
                            date_from: date_from,
                            date_to: date_to}),
        }).then(response => {
        if (response.status === 200) {
            
            alert("Номер добавлен в корзину");
            
            
            var url_1 = 'pages/hotels/' + hotel_id + '/rooms?date_from=' + date_from + '&date_to=' + date_to;
            fetch('pages/bookings')
                .then(response => response.text())
                .then(data => { myDiv.innerHTML = data, htmx.process(myDiv); } );
            fetch(url_1)
                .then(response => response.text())
                .then(data => { myDiv_1.innerHTML = data, htmx.process(myDiv_1); } );
            
        }
        else if (response.status === 401) {
            alert("Войдите в систему");
        }
        else if (response.status === 409) {
            alert("Не осталось свободных номеров");
        }
        
});
}

        </script>
        <script>
            function cancel(val) {
    let obj = document.getElementById(val);
    obj.style.display = "none";  
}
        </script>
        <script>

async function loginUser() {
    const wrongCredentialsSpan = document.getElementById("wrong_credentials");
    wrongCredentialsSpan.textContent = "";

    const url = "/auth/login";
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    let myDiv = document.getElementById('nav_box');
    await fetch(url, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'}, 
        body: JSON.stringify({email: email, password: password}),
    }).then(response => {
        if (response.status === 200) {
            //window.location.href = "/pages/bookings"
            var url = "/pages/bookings";
            fetch(url)
                .then(response => response.text())
                .then(data => { myDiv.innerHTML = data, htmx.process(myDiv); } );
            cancel("logpanel");
        
        } else {
            wrongCredentialsSpan.textContent = "Неверный email или пароль";
        }
    });
}
        </script>
        <script>

async function logoutUser() {
    const url = "/auth/logout";

    await fetch(url, {
        method: 'POST',
    }).then(response => {
        if (response.status === 200) {
            window.location.href = "/pages"
        }
    });
}
        </script>
        <script>

async function regUser() {
    const wrongCredentialsSpan = document.getElementById("wrong_credentials");
    wrongCredentialsSpan.textContent = "";
    let email_pole = document.getElementById("email");
    let password_pole = document.getElementById("password");
    let button = document.getElementById("log_button");
    let l_pass = document.getElementById("l_pass");
    let l_em = document.getElementById("l_em");
    const url = "/auth/register";
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    if (email=="" || password=="") {
        wrongCredentialsSpan.textContent = "Не введён email или пароль";
    } 
    else {
    await fetch(url, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'}, 
        body: JSON.stringify({email: email, password: password}),
    }).then(response => {
        if (response.status === 200) {
            wrongCredentialsSpan.textContent = "Вы зарегистрированы. Войдите в систему.";
            button.style.display = "none";
            email_pole.style.display = "none";
            password_pole.style.display = "none";
            l_pass.style.display = "none";
            l_em.style.display = "none";
        } else if (response.status === 409) {
            wrongCredentialsSpan.textContent = "Пользователь с таким логином уже существует";
        } else {
            wrongCredentialsSpan.textContent = "Ошибка регистрации";
        }
    });
}
}
        </script>
    <title>ONBOOK</title>
</head>

<body id="main">
    <datalist id="hotel_list">
        <option value="Алтай"></option>
        <option value="Сыктывкар"></option>
        <option value="Сириус"></option>
    
    </datalist>
    <div id="nav_box" >
    <nav id="nav" class="nav" >
        <span class="logo">ONBOOK</span>
        <ul class="menu">
            
            <li class="link" hx-get="/pages/search" hx-target="#bookings_list" 
            hx-swap="innerHTML transition:true">Поиск отелей</li>
            <li class="link" hx-get="/pages/login" hx-target="#login_bar" 
            hx-swap="innerHTML transition:true">Войти</li>
        </ul>
    </nav>
</div>
    <div id="login_bar"></div>
    <div id="bookings_list" class="bookings_list" hx-swap="outerHTML transition:true"><span></span></div>
    
    <footer class="footer">
        <div class="footer__top">
            <div class="footer__left">
                <div class="logo">ONBOOK</div>
                <div class="text">Simple booking</div>
            </div>
            <div class="footer__right">

                <div class="contact">Как с нами связаться</div>
                <div class="phone">+7 (800)800-20-20</div>
                <div class="address">Екатеринбург, ул.Московская, д.3</div>
            </div>
        </div>
        <div class="footer__bottom">ONBOOK All rights reserved.</div>

    </footer>

</body>

</html>